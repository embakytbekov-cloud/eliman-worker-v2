<script src="https://telegram.org/js/telegram-web-app.js"></script>

<script>
  const tg = window.Telegram.WebApp
  tg.ready()
  tg.expand()

  async function initWorkerAndGo() {
    const telegramId = tg.initDataUnsafe?.user?.id
    if (!telegramId) {
      alert('No Telegram user')
      return
    }

    // ⬇️ ТУТ Supabase
    const { data: worker } = await supabase
      .from('workers')
      .select('*')
      .eq('telegram_id', telegramId)
      .maybeSingle()

    if (!worker) {
      await supabase.from('workers').insert({
        telegram_id: telegramId,
        categories: []
      })
    }

    // ⬇️ ТОЛЬКО ПОСЛЕ ЭТОГО
    window.location.replace("register.html")
  }

  initWorkerAndGo()
</script>